# Mattermost v11.3 AdvancedLoggingJSON Configuration Changes

## Overview

Starting with Mattermost server v11.3, the `AdvancedLoggingJSON` configuration validation has been enhanced to enforce proper log level separation between standard logging and audit logging configurations.

## What Changed

### Enhanced Validation Rules

The system now validates that:

1. **Standard Logging** (`LogSettings.AdvancedLoggingJSON`) only accepts standard log levels
2. **Audit Logging** (`ExperimentalAuditSettings.AdvancedLoggingJSON`) only accepts audit-specific log levels  
3. Cross-contamination between logging types is rejected with validation errors

### Admin Console UI Changes

- **Previous**: "Audit logging (Beta)" 
- **Current**: "Audit Logging" (beta status remains in backend)

## Log Level Reference

### Standard Log Levels (for LogSettings)
These levels are **accepted** in `LogSettings.AdvancedLoggingJSON`:

- `panic` (ID: 0)
- `fatal` (ID: 1) 
- `error` (ID: 2)
- `warn` (ID: 3)
- `info` (ID: 4)
- `debug` (ID: 5)
- `trace` (ID: 6)
- `critical` (ID: 7)
- `stdlog` (ID: 10)
- Plus specialized levels: LDAP, Remote Cluster Service, Shared Channel Service, Notification Service

### Audit Log Levels (for ExperimentalAuditSettings)
These levels are **accepted** in `ExperimentalAuditSettings.AdvancedLoggingJSON`:

- `audit-api` (ID: 100) - REST API endpoint access auditing
- `audit-content` (ID: 101) - Content creation auditing (posts, reactions)
- `audit-permissions` (ID: 102) - Permission check auditing 
- `audit-cli` (ID: 103) - CLI operation auditing (legacy, mostly unused)

## Configuration Examples

### Standard Logging Configuration
```json
{
  "LogSettings": {
    "AdvancedLoggingJSON": {
      "console": {
        "Type": "console",
        "Format": "plain",
        "Levels": [
          {"ID": 2, "Name": "error"},
          {"ID": 3, "Name": "warn"}, 
          {"ID": 4, "Name": "info"}
        ]
      }
    }
  }
}
```

### Audit Logging Configuration  
```json
{
  "ExperimentalAuditSettings": {
    "AdvancedLoggingJSON": {
      "audit": {
        "Type": "file",
        "Format": "json",
        "Levels": [
          {"ID": 100, "Name": "audit-api"},
          {"ID": 101, "Name": "audit-content"},
          {"ID": 102, "Name": "audit-permissions"}
        ],
        "Options": {
          "Filename": "audit.log"
        }
      }
    }
  }
}
```

## Error Scenarios and Troubleshooting

### Common Validation Errors

#### Using Audit Levels in Standard Logging
**Error**: `model.config.is_valid.log.advanced_logging.parse`

**Cause**: Attempting to use audit levels (`audit-api`, `audit-content`, etc.) in `LogSettings.AdvancedLoggingJSON`

**Fix**: Move audit level configurations to `ExperimentalAuditSettings.AdvancedLoggingJSON`

**Example Problem**:
```json
{
  "LogSettings": {
    "AdvancedLoggingJSON": {
      "console": {
        "Levels": [{"ID": 100, "Name": "audit-api"}]  // ❌ INVALID
      }
    }
  }
}
```

**Example Solution**:
```json
{
  "ExperimentalAuditSettings": {
    "AdvancedLoggingJSON": {
      "audit": {
        "Levels": [{"ID": 100, "Name": "audit-api"}]  // ✅ VALID
      }
    }
  }
}
```

#### Using Standard Levels in Audit Logging  
**Error**: `model.config.is_valid.log.advanced_logging.parse`

**Cause**: Attempting to use standard levels (`error`, `info`, etc.) in `ExperimentalAuditSettings.AdvancedLoggingJSON`

**Fix**: Move standard level configurations to `LogSettings.AdvancedLoggingJSON`

#### Invalid Level IDs
**Error**: `model.config.is_valid.log.advanced_logging.json` 

**Cause**: Using non-existent level IDs or malformed JSON

**Fix**: Ensure all level IDs correspond to valid log levels and JSON is properly formatted

## Migration Guide

### For System Administrators

1. **Review Current Configuration**: Check your `config.json` for any mixed level usage
2. **Separate Configurations**: Ensure audit levels are only in `ExperimentalAuditSettings`
3. **Update Admin Console References**: UI now shows "Audit Logging" instead of "Audit logging (Beta)"
4. **Test Configuration**: Validate your configuration loads without errors after upgrade

### For Documentation Writers

Update references to:
- Admin console audit logging section name
- AdvancedLoggingJSON validation behavior
- Configuration examples showing proper separation
- Error handling and troubleshooting guides

## API Changes

No breaking API changes - this is a configuration validation enhancement that provides better error messages and enforces existing intended behavior.