schemaVersion: 2.0.0
metadata:
  name: mattermost
  version: 1.0.0
  displayName: Mattermost Development Environment
  description: Development environment for Mattermost platform (Go server and React webapp)
components:
  - name: dev
    container:
      image: public.ecr.aws/aws-mde/universal-image:latest
      memoryLimit: 8Gi
      mountSources: true
commands:
  - id: install
    exec:
      component: dev
      commandLine: "cd ${PROJECT_SOURCE}/webapp && npm install && cd ${PROJECT_SOURCE}/api && npm install && cd ${PROJECT_SOURCE}/server && go mod download"
      workingDir: ${PROJECT_SOURCE}
  - id: build
    exec:
      component: dev
      commandLine: "cd ${PROJECT_SOURCE}/webapp && npm run build && cd ${PROJECT_SOURCE}/server && go build -o mattermost ./cmd/mattermost"
      workingDir: ${PROJECT_SOURCE}
  - id: test
    exec:
      component: dev
      commandLine: "cd ${PROJECT_SOURCE}/webapp && npm test && cd ${PROJECT_SOURCE}/server && go test ./..."
      workingDir: ${PROJECT_SOURCE}