---
phase: 04-scheduled-tab
plan: 04
type: execute
wave: 4
depends_on: [04-03]
files_modified:
  - webapp/channels/src/components/recaps/scheduled_recaps_list.tsx
  - webapp/channels/src/components/recaps/scheduled_recaps_empty_state.tsx
  - webapp/channels/src/components/recaps/recaps.tsx
  - webapp/channels/src/components/recaps/recaps.scss
  - webapp/channels/src/components/recaps/index.ts
autonomous: false

must_haves:
  truths:
    - "Scheduled tab appears alongside Unread and Read tabs"
    - "Clicking Scheduled tab shows list of scheduled recaps"
    - "Empty state shows when no scheduled recaps exist"
    - "Edit action opens wizard modal (pre-filled)"
    - "User can view, pause/resume, and delete scheduled recaps"
  artifacts:
    - path: "webapp/channels/src/components/recaps/scheduled_recaps_list.tsx"
      provides: "List component for scheduled recaps"
      contains: "ScheduledRecapsList"
    - path: "webapp/channels/src/components/recaps/scheduled_recaps_empty_state.tsx"
      provides: "Empty state for scheduled tab"
      contains: "ScheduledRecapsEmptyState"
    - path: "webapp/channels/src/components/recaps/recaps.tsx"
      provides: "Main recaps component with Scheduled tab"
      contains: "scheduled"
  key_links:
    - from: "webapp/channels/src/components/recaps/recaps.tsx"
      to: "webapp/channels/src/packages/mattermost-redux/src/selectors/entities/recaps.ts"
      via: "useSelector(getAllScheduledRecaps)"
      pattern: "useSelector.*getAllScheduledRecaps"
    - from: "webapp/channels/src/components/recaps/scheduled_recaps_list.tsx"
      to: "webapp/channels/src/components/recaps/scheduled_recap_item.tsx"
      via: "renders ScheduledRecapItem for each recap"
      pattern: "ScheduledRecapItem"
---

<objective>
Integrate the Scheduled tab into the main Recaps view with list and empty state

Purpose: Allow users to view and manage their scheduled recaps through the UI
Output: Working Scheduled tab with full CRUD-like functionality (view, pause/resume, delete, edit)
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-scheduled-tab/04-CONTEXT.md
@.planning/codebase/CONVENTIONS.md

# Main recaps component to modify
@webapp/channels/src/components/recaps/recaps.tsx
@webapp/channels/src/components/recaps/recaps_list.tsx
@webapp/channels/src/components/recaps/recaps.scss

# Components from Plan 03
# ScheduledRecapItem, useScheduleDisplay

# Redux selectors
@webapp/channels/src/packages/mattermost-redux/src/selectors/entities/recaps.ts

# Create recap modal for edit
@webapp/channels/src/components/create_recap_modal
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ScheduledRecapsEmptyState component</name>
  <files>webapp/channels/src/components/recaps/scheduled_recaps_empty_state.tsx</files>
  <action>
Create the empty state component for when no scheduled recaps exist:

```typescript
// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.
// See LICENSE.txt for license information.

import React from 'react';
import {useIntl} from 'react-intl';

import {PlusIcon} from '@mattermost/compass-icons/components';

type Props = {
    onCreateClick: () => void;
    disabled?: boolean;
};

const ScheduledRecapsEmptyState = ({onCreateClick, disabled}: Props) => {
    const {formatMessage} = useIntl();

    return (
        <div className='scheduled-recaps-empty-state'>
            <div className='empty-state-illustration'>
                {/* Simplified illustration - matches Figma design concept */}
                <div className='illustration-icons'>
                    <i className='icon icon-message-text-outline'/>
                    <i className='icon icon-calendar-outline'/>
                    <i className='icon icon-file-document-outline'/>
                </div>
            </div>
            <h2 className='empty-state-title'>
                {formatMessage({id: 'recaps.scheduled.emptyState.title', defaultMessage: 'Set up your first recap'})}
            </h2>
            <p className='empty-state-description'>
                {formatMessage({
                    id: 'recaps.scheduled.emptyState.description',
                    defaultMessage: 'Copilot recaps help you get caught up quickly on discussions that are most important to you with a summarized report.',
                })}
            </p>
            <button
                className='btn btn-primary empty-state-cta'
                onClick={onCreateClick}
                disabled={disabled}
            >
                <PlusIcon size={16}/>
                {formatMessage({id: 'recaps.scheduled.emptyState.cta', defaultMessage: 'Create a recap'})}
            </button>
        </div>
    );
};

export default ScheduledRecapsEmptyState;
```
  </action>
  <verify>TypeScript compiles: `cd webapp && npm run check-types 2>&1 | head -20`</verify>
  <done>ScheduledRecapsEmptyState component renders illustration, heading, description, and CTA button</done>
</task>

<task type="auto">
  <name>Task 2: Create ScheduledRecapsList component</name>
  <files>webapp/channels/src/components/recaps/scheduled_recaps_list.tsx</files>
  <action>
Create the list component for scheduled recaps:

```typescript
// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.
// See LICENSE.txt for license information.

import React from 'react';

import type {ScheduledRecap} from '@mattermost/types/recaps';

import ScheduledRecapItem from './scheduled_recap_item';
import ScheduledRecapsEmptyState from './scheduled_recaps_empty_state';

type Props = {
    scheduledRecaps: ScheduledRecap[];
    onEdit: (id: string) => void;
    onCreateClick: () => void;
    createDisabled?: boolean;
};

const ScheduledRecapsList = ({scheduledRecaps, onEdit, onCreateClick, createDisabled}: Props) => {
    if (scheduledRecaps.length === 0) {
        return (
            <ScheduledRecapsEmptyState
                onCreateClick={onCreateClick}
                disabled={createDisabled}
            />
        );
    }

    return (
        <div className='scheduled-recaps-list'>
            {scheduledRecaps.map((scheduledRecap) => (
                <ScheduledRecapItem
                    key={scheduledRecap.id}
                    scheduledRecap={scheduledRecap}
                    onEdit={onEdit}
                />
            ))}
        </div>
    );
};

export default ScheduledRecapsList;
```
  </action>
  <verify>TypeScript compiles: `cd webapp && npm run check-types 2>&1 | head -20`</verify>
  <done>ScheduledRecapsList renders empty state when empty, otherwise maps over scheduled recaps to render ScheduledRecapItem</done>
</task>

<task type="auto">
  <name>Task 3: Add Scheduled tab to main Recaps component</name>
  <files>webapp/channels/src/components/recaps/recaps.tsx</files>
  <action>
Modify the main Recaps component to add the Scheduled tab:

1. Add imports at top:
```typescript
import {getScheduledRecaps} from 'mattermost-redux/actions/recaps';
import {getAllScheduledRecaps} from 'mattermost-redux/selectors/entities/recaps';
import ScheduledRecapsList from './scheduled_recaps_list';
import './scheduled_recap_item.scss';
```

2. Update the activeTab state type to include 'scheduled':
```typescript
const [activeTab, setActiveTab] = useState<'unread' | 'read' | 'scheduled'>('unread');
```

3. Add selector for scheduled recaps after existing selectors:
```typescript
const scheduledRecaps = useSelector(getAllScheduledRecaps);
```

4. Add fetch for scheduled recaps in useEffect:
```typescript
useEffect(() => {
    dispatch(getRecaps(0, 60));
    dispatch(getScheduledRecaps(0, 60));
    dispatch(getAgents());
}, [dispatch]);
```

5. Add handler for edit action (will open modal):
```typescript
const handleEditScheduledRecap = (id: string) => {
    // TODO: Phase 5 will implement edit modal with pre-filled values
    // For now, just open the create modal (edit functionality comes in Phase 5)
    dispatch(openModal({
        modalId: ModalIdentifiers.CREATE_RECAP_MODAL,
        dialogType: CreateRecapModal,
    }));
};
```

6. Add the Scheduled tab button after the Read tab in the JSX:
```jsx
<button
    className={`recaps-tab ${activeTab === 'scheduled' ? 'active' : ''}`}
    onClick={() => setActiveTab('scheduled')}
>
    {formatMessage({id: 'recaps.scheduled.tab', defaultMessage: 'Scheduled'})}
</button>
```

7. Update the content rendering to show ScheduledRecapsList when on scheduled tab:
```jsx
<div className='recaps-content'>
    {activeTab === 'scheduled' ? (
        <ScheduledRecapsList
            scheduledRecaps={scheduledRecaps}
            onEdit={handleEditScheduledRecap}
            onCreateClick={handleAddRecap}
            createDisabled={agentsBridgeEnabled === false}
        />
    ) : (
        <RecapsList recaps={displayedRecaps}/>
    )}
</div>
```

8. Update displayedRecaps to not include scheduled tab:
```typescript
const displayedRecaps = activeTab === 'unread' ? unreadRecaps : readRecaps;
```
(This line stays the same - displayedRecaps is only for unread/read tabs)
  </action>
  <verify>TypeScript compiles: `cd webapp && npm run check-types 2>&1 | head -20`</verify>
  <done>Recaps component has Scheduled tab that shows ScheduledRecapsList, fetches scheduled recaps on mount</done>
</task>

<task type="auto">
  <name>Task 4: Add styles for scheduled recaps</name>
  <files>webapp/channels/src/components/recaps/recaps.scss</files>
  <action>
Add styles for the scheduled recaps list and empty state. Add these at the end of the existing file (before the closing brace if there is one, or at the end):

```scss
// Scheduled Recaps List Styles
.scheduled-recaps-list {
    display: flex;
    max-width: 966px;
    flex-direction: column;
    margin: 0 auto;
    gap: 12px;
}

// Scheduled Recaps Empty State
.scheduled-recaps-empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    max-width: 400px;
    padding: 80px 24px;
    margin: 0 auto;
    text-align: center;

    .empty-state-illustration {
        margin-bottom: 24px;

        .illustration-icons {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;

            .icon {
                color: rgba(var(--center-channel-color-rgb), 0.48);
                font-size: 32px;
            }
        }
    }

    .empty-state-title {
        margin: 0 0 8px;
        color: var(--center-channel-color);
        font-family: 'Metropolis', sans-serif;
        font-size: 20px;
        font-weight: 600;
        line-height: 28px;
    }

    .empty-state-description {
        margin: 0 0 24px;
        color: rgba(var(--center-channel-color-rgb), 0.72);
        font-size: 14px;
        line-height: 20px;
    }

    .empty-state-cta {
        display: flex;
        align-items: center;
        gap: 8px;
    }
}
```
  </action>
  <verify>File updated: `grep -l "scheduled-recaps-list" webapp/channels/src/components/recaps/recaps.scss`</verify>
  <done>SCSS styles added for scheduled-recaps-list and scheduled-recaps-empty-state</done>
</task>

<task type="auto">
  <name>Task 5: Update index.ts exports</name>
  <files>webapp/channels/src/components/recaps/index.ts</files>
  <action>
Check if index.ts exists and update exports to include new components. If it exists and exports components, add:

```typescript
export {default as ScheduledRecapItem} from './scheduled_recap_item';
export {default as ScheduledRecapsList} from './scheduled_recaps_list';
export {default as ScheduledRecapsEmptyState} from './scheduled_recaps_empty_state';
export {useScheduleDisplay} from './schedule_display';
```

If index.ts doesn't exist or only has a default export, skip this task - the imports in recaps.tsx are relative and don't need barrel exports.
  </action>
  <verify>If file exists, check exports: `cat webapp/channels/src/components/recaps/index.ts 2>/dev/null || echo "No index.ts"`</verify>
  <done>Exports updated (or skipped if not needed)</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Scheduled tab UI with list of scheduled recaps:
- "Scheduled" tab appears alongside "Unread" and "Read" tabs
- Clicking Scheduled tab shows list of user's scheduled recaps from API
- Each scheduled recap card shows: title, schedule pattern, next run time
- Active/Paused toggle updates backend and UI immediately
- Run stats (last run, run count) appear on hover
- Kebab menu has Edit and Delete options
- Delete shows confirmation modal before deleting
- Empty state shows when no scheduled recaps exist
  </what-built>
  <how-to-verify>
1. Start the dev server: `cd webapp && npm run dev`
2. Navigate to Recaps view in the app
3. Verify "Scheduled" tab appears after "Unread" and "Read"
4. Click "Scheduled" tab
5. If you have scheduled recaps from API testing:
   - Verify cards display title, schedule, next run
   - Hover over a card to see run stats
   - Toggle Active/Paused - verify it updates
   - Open kebab menu - verify Edit and Delete options
   - Click Delete - verify confirmation modal appears
6. If no scheduled recaps:
   - Verify empty state displays with illustration, heading, description, CTA

Note: Edit opens the create modal placeholder - actual edit functionality is Phase 5.
  </how-to-verify>
  <resume-signal>Type "approved" if Scheduled tab works, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] ScheduledRecapsEmptyState renders illustration, heading, description, CTA
- [ ] ScheduledRecapsList renders empty state or list of items
- [ ] Recaps component has three tabs: Unread, Read, Scheduled
- [ ] Scheduled tab fetches and displays scheduled recaps from Redux
- [ ] Edit action triggers (modal opens - edit pre-fill is Phase 5)
- [ ] All components styled consistently with existing recap UI
- [ ] TypeScript compiles successfully
- [ ] Human verified: UI works in browser
</verification>

<success_criteria>
User can navigate to Scheduled tab, see their scheduled recaps, toggle pause/resume, delete with confirmation, and see empty state when no schedules exist.
</success_criteria>

<output>
After completion, create `.planning/phases/04-scheduled-tab/04-04-SUMMARY.md`
</output>
