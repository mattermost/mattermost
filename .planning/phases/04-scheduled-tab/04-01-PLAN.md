---
phase: 04-scheduled-tab
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - webapp/platform/types/src/recaps.ts
  - webapp/platform/types/src/index.ts
  - webapp/platform/client/src/client4.ts
autonomous: true

must_haves:
  truths:
    - "ScheduledRecap TypeScript type exists with all fields from Go model"
    - "Client4 has methods for all 7 scheduled recap API endpoints"
    - "Types are exported from platform/types index"
  artifacts:
    - path: "webapp/platform/types/src/recaps.ts"
      provides: "ScheduledRecap type definition"
      contains: "ScheduledRecap"
    - path: "webapp/platform/client/src/client4.ts"
      provides: "Scheduled recap API methods"
      contains: "getScheduledRecaps"
  key_links:
    - from: "webapp/platform/client/src/client4.ts"
      to: "webapp/platform/types/src/recaps.ts"
      via: "import type"
      pattern: "import.*ScheduledRecap.*from.*@mattermost/types/recaps"
---

<objective>
Add TypeScript types and Client4 API methods for scheduled recaps

Purpose: Enable frontend to communicate with scheduled recap backend endpoints created in Phase 2
Output: ScheduledRecap type + 7 client methods matching API endpoints
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-scheduled-tab/04-CONTEXT.md
@.planning/codebase/CONVENTIONS.md

# Reference existing recap types pattern
@webapp/platform/types/src/recaps.ts

# Reference existing Client4 recap methods pattern
@webapp/platform/client/src/client4.ts (search for "Recaps Routes")

# Reference Go model for field names
@server/public/model/scheduled_recap.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ScheduledRecap TypeScript type</name>
  <files>webapp/platform/types/src/recaps.ts</files>
  <action>
Add the ScheduledRecap type to the existing recaps.ts file. Match the Go struct field names exactly (snake_case for JSON serialization).

Add after existing types:

```typescript
export type ScheduledRecap = {
    id: string;
    user_id: string;
    title: string;

    // Schedule configuration
    days_of_week: number;      // Bitmask: Sun=1, Mon=2, Tue=4, Wed=8, Thu=16, Fri=32, Sat=64
    time_of_day: string;       // HH:MM format
    timezone: string;          // IANA timezone
    time_period: string;       // "last_24h" | "last_week" | "since_last_read"

    // Schedule state
    next_run_at: number;       // UTC milliseconds
    last_run_at: number;       // UTC milliseconds
    run_count: number;

    // Channel configuration
    channel_mode: string;      // "specific" | "all_unreads"
    channel_ids?: string[];    // Present when mode = "specific"

    // AI configuration
    custom_instructions?: string;
    agent_id: string;

    // Schedule type and state
    is_recurring: boolean;
    enabled: boolean;

    // Timestamps
    create_at: number;
    update_at: number;
    delete_at: number;
};
```

Also add a helper type for creating/updating:

```typescript
export type ScheduledRecapInput = {
    title: string;
    days_of_week: number;
    time_of_day: string;
    timezone: string;
    time_period: string;
    channel_mode: string;
    channel_ids?: string[];
    custom_instructions?: string;
    agent_id: string;
    is_recurring: boolean;
};
```
  </action>
  <verify>TypeScript compiles: `cd webapp && npm run check-types 2>&1 | head -20`</verify>
  <done>ScheduledRecap and ScheduledRecapInput types exist in recaps.ts with all fields matching Go model</done>
</task>

<task type="auto">
  <name>Task 2: Add Client4 scheduled recap route helper</name>
  <files>webapp/platform/client/src/client4.ts</files>
  <action>
Add route helper method after existing getRecapsRoute():

```typescript
getScheduledRecapsRoute() {
    return `${this.getBaseRoute()}/scheduled_recaps`;
}
```

Also update the import at top of file to include the new types:
- Change: `import type {Recap, CreateRecapRequest} from '@mattermost/types/recaps';`
- To: `import type {Recap, CreateRecapRequest, ScheduledRecap, ScheduledRecapInput} from '@mattermost/types/recaps';`
  </action>
  <verify>TypeScript compiles: `cd webapp && npm run check-types 2>&1 | head -20`</verify>
  <done>getScheduledRecapsRoute() method exists and types are imported</done>
</task>

<task type="auto">
  <name>Task 3: Add Client4 scheduled recap API methods</name>
  <files>webapp/platform/client/src/client4.ts</files>
  <action>
Add 7 API methods after existing recap methods (after deleteRecap). Follow the existing pattern exactly:

```typescript
// Scheduled Recaps Routes
createScheduledRecap = (input: ScheduledRecapInput) => {
    return this.doFetch<ScheduledRecap>(
        `${this.getScheduledRecapsRoute()}`,
        {method: 'post', body: input},
    );
};

getScheduledRecaps = (page = 0, perPage = PER_PAGE_DEFAULT) => {
    return this.doFetch<ScheduledRecap[]>(
        `${this.getScheduledRecapsRoute()}${buildQueryString({page, per_page: perPage})}`,
        {method: 'get'},
    );
};

getScheduledRecap = (id: string) => {
    return this.doFetch<ScheduledRecap>(
        `${this.getScheduledRecapsRoute()}/${id}`,
        {method: 'get'},
    );
};

updateScheduledRecap = (id: string, input: ScheduledRecapInput) => {
    return this.doFetch<ScheduledRecap>(
        `${this.getScheduledRecapsRoute()}/${id}`,
        {method: 'put', body: input},
    );
};

deleteScheduledRecap = (id: string) => {
    return this.doFetch<void>(
        `${this.getScheduledRecapsRoute()}/${id}`,
        {method: 'delete'},
    );
};

pauseScheduledRecap = (id: string) => {
    return this.doFetch<ScheduledRecap>(
        `${this.getScheduledRecapsRoute()}/${id}/pause`,
        {method: 'post'},
    );
};

resumeScheduledRecap = (id: string) => {
    return this.doFetch<ScheduledRecap>(
        `${this.getScheduledRecapsRoute()}/${id}/resume`,
        {method: 'post'},
    );
};
```
  </action>
  <verify>TypeScript compiles: `cd webapp && npm run check-types 2>&1 | head -20`</verify>
  <done>All 7 Client4 methods exist and compile without errors</done>
</task>

</tasks>

<verification>
- [ ] ScheduledRecap type has all fields from Go model
- [ ] ScheduledRecapInput type has fields needed for create/update
- [ ] Types are properly exported (check webapp/platform/types/src/index.ts if needed)
- [ ] Client4 has getScheduledRecapsRoute() method
- [ ] Client4 has all 7 API methods: create, get, getAll, update, delete, pause, resume
- [ ] All methods use correct HTTP verbs matching API (POST, GET, PUT, DELETE)
- [ ] TypeScript compiles successfully
</verification>

<success_criteria>
Frontend code can import ScheduledRecap type and call Client4 scheduled recap methods. Type checking passes.
</success_criteria>

<output>
After completion, create `.planning/phases/04-scheduled-tab/04-01-SUMMARY.md`
</output>
