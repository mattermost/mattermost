## Objective

Implement the **remaining Plugin API handlers** in the gRPC `PluginAPI` service that are not covered by:

- 04-02 (User/Team/Channel)
- 04-03 (Post/File/KV)

This plan is about completing API parity on the Go server wrapper side so the Python SDK (Phase 6) can rely on full coverage.

## Execution Context

- `.planning/STATE.md`, `.planning/ROADMAP.md`
- `.planning/phases/01-protocol-foundation/01-RESEARCH.md` (error/status conventions)
- Must already exist:
  - Generated pb code: `server/public/pluginapi/grpc/generated/go/`
  - Server wrapper scaffold + patterns from 04-01..04-03
- Authoritative interface + tagging:
  - `server/public/plugin/api.go`
- Existing Go plugin system must remain unchanged:
  - `server/public/plugin/client.go` explicitly says Go plugins are net/rpc only

## Context

### What’s Left?

The “remaining” API typically includes (exact grouping depends on tags in `api.go`):

- Plugin configuration / server configuration methods
- Commands, webhooks, OAuth helpers
- Bots, emojis, preferences
- Cluster / telemetry / licensing reads
- Anything tagged outside User/Team/Channel/Post/File/KV

The authoritative source is `server/public/plugin/api.go`. Do not rely on memory—generate a checklist.

### Coverage Strategy

Because this slice is heterogeneous, success depends on:

- A complete checklist of remaining methods
- Aggressive unit test sampling across different “shapes”:
  - scalar returns (string/bool)
  - complex object returns
  - map/Struct returns
  - “void + error” patterns

## Tasks

### Task 1: Generate “remaining methods” checklist

- Parse `server/public/plugin/api.go` and build a list of all methods.
- Subtract the methods already implemented in 04-02 and 04-03.
- The output should be a deterministic list (saved in the PR description or as test assertions, not as a new markdown file).

Then cross-check against `api.proto` RPC list:

- Every remaining interface method should have a matching RPC
- Naming and request/response message shapes should be consistent

If proto definitions are missing or inconsistent: fix Phase 2 first.

### Task 2: Implement conversions for remaining types

Add conversion helpers as needed for any new types introduced by remaining methods.

Guidelines:

- Keep conversion code close to usage and split files by domain (e.g., `convert_command.go`, `convert_config.go`).
- For “map-like” returns (e.g., `map[string]any`), use the Phase 2 protobuf decision consistently (`Struct`/`Any`/JSON bytes).

### Task 3: Implement remaining RPC handlers

Implement the remaining RPC methods using the established pattern:

- Validate request
- Convert pb → model
- Call `s.impl.Method(...)`
- Convert model → pb
- Map errors via shared helpers

As you implement, keep the server wrapper maintainable:

- Prefer many small domain files (`api_config.go`, `api_command.go`, …) over a single gigantic file.

### Task 4: Add “shape coverage” tests

Using bufconn + `plugintest.API` mocks, add unit tests covering at least:

- One config-related call
- One command-related call
- One method involving `map[string]any` / Struct conversion (if present)
- One method returning `error` (not `*model.AppError`) to validate fallback error mapping
- One method returning `*model.AppError` with a non-500 status to validate code mapping

### Task 5: Add a completeness guard

Add a compile-time or test-time guard to reduce “silent missing methods” risk:

- Option A (preferred): a unit test that uses Go reflection on the generated pb server interface and asserts that every RPC method is overridden OR intentionally left to `Unimplemented` (explicit list)
- Option B: a test that calls `grpcurl`-style reflection is not available in unit tests; avoid runtime reflection dependencies unless already present

The goal is to ensure future API additions to `api.proto` don’t get silently skipped.

## Verification

- `cd server/public && go test ./pluginapi/grpc/server -v`
- (Optional) `cd server/public && go test ./...` to ensure no cross-package breakage

## Success Criteria

- All remaining RPCs from the checklist are implemented and tested.
- No drift between `plugin.API` and protobuf `PluginAPI` service remains (method names + shapes match).
- Wrapper remains readable via domain-split files.

## Output

- **Modified**:
  - `server/public/pluginapi/grpc/server/*` (server methods + tests)
- **New (likely)**:
  - Additional `api_*.go` and `convert_*.go` files for remaining domains


