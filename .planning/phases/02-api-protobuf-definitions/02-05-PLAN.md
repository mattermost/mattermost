---
phase: 02-api-protobuf-definitions
plan: 05
type: execute
depends_on: ["02-02", "02-03", "02-04"]
files_modified:
  - server/public/pluginapi/grpc/proto/api_remaining.proto
  - server/public/pluginapi/grpc/proto/bootstrap.proto
  - server/public/pluginapi/grpc/proto/plugin.proto
---

<objective>
Define protobuf request/response messages for all remaining Plugin API methods not covered by the earlier plans (OAuth, Preferences, Groups, SharedChannels, Property APIs, Server/Admin-ish utilities, Commands, and untagged methods like PluginHTTP).

Purpose: Complete Phase 2 by eliminating all remaining placeholders and ensuring protobuf coverage for every Plugin API method.
Output: Fully-specified `api_remaining.proto` and Phase 2 “no placeholders anywhere” verification.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-protocol-foundation/01-RESEARCH.md

# Source of truth: signatures + semantics
@server/public/plugin/api.go

# Proto skeleton + generation tooling
@server/public/pluginapi/grpc/proto/api.proto
@server/public/pluginapi/grpc/proto/api_remaining.proto
@server/public/pluginapi/grpc/proto/bootstrap.proto
@server/public/Makefile

# Model sources of truth for this plan (spot-check as needed)
@server/public/model/group.go
@server/public/model/oauth.go
@server/public/model/preference.go
@server/public/model/shared_channel.go
@server/public/model/property_field.go
@server/public/model/property_group.go
@server/public/model/property_value.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement remaining method messages (OAuth, Preferences, Group, SharedChannels, Property*, Server/Command, misc)</name>
  <files>server/public/pluginapi/grpc/proto/api_remaining.proto, server/public/pluginapi/grpc/proto/bootstrap.proto, server/public/pluginapi/grpc/proto/plugin.proto</files>
  <action>
Replace placeholders in `api_remaining.proto` for every method assigned to this file by the `02-01` grouping rule, including (at minimum):
- OAuth APIs (`model.OAuthApp`, connect/complete flows, etc.)
- Preferences APIs (`model.Preference` and preference list operations)
- Groups + Group syncables (`model.Group*`, `model.GroupSyncable*`)
- Shared channels (`model.SharedChannel`, related operations)
- Property APIs (`model.PropertyField`, `model.PropertyValue`, `model.PropertyGroup`, search options)
- Audit record APIs (`model.AuditRecord`)
- Slash command / command APIs (`model.Command`, `model.CommandArgs`, `model.CommandResponse`)
- “Server-ish” / misc APIs: license/trial, mail/push, permission helpers, cluster events, cloud limits, etc.

Also implement the untagged but explicitly overridden methods that land here:
- `PluginHTTP(*http.Request) *http.Response`:
  - Define explicit proto messages for an HTTP request/response (method, url, headers, body).
  - Prefer a unary body `bytes` initially; keep the shape extensible for future streaming (Phase 8).
  - Preserve parity with Go’s behavior as documented in `plugin/api.go`.

Maintain Phase 2 conventions:
- `AppError error = 1;` in every response
- snake_case fields
- Add missing shared types to `plugin.proto` (or shared helper types to `bootstrap.proto`) rather than inventing per-plan duplicates.
  </action>
  <verify>make -C server/public proto-gen succeeds AND no TODO placeholders remain for methods assigned to `api_remaining.proto`</verify>
  <done>All remaining methods have fully specified messages, and Go proto generation succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Phase 2 completeness sweep (no placeholders anywhere + parity verified)</name>
  <files>server/public/pluginapi/grpc/proto/*.proto</files>
  <action>
Do a Phase 2 final sweep across all proto files in `server/public/pluginapi/grpc/proto/`:

- Ensure there are **zero** placeholder TODOs left anywhere in:
  - `api_user_team.proto`
  - `api_channel_post.proto`
  - `api_kv_config.proto`
  - `api_file_bot.proto`
  - `api_remaining.proto`

- Run the parity guardrail:
  - `go run ./server/public/pluginapi/grpc/cmd/apiverify` must report zero missing/extra RPCs vs `server/public/plugin/api.go`.

- Run generation:
  - `make -C server/public proto-gen` must succeed.

If there are any remaining “representation decisions” (Struct vs JSON wrappers for big structs like Config/License/Manifest), document the choice in the SUMMARY and apply it consistently across the API.
  </action>
  <verify>grep -R \"TODO\" server/public/pluginapi/grpc/proto/*.proto returns nothing AND go run ./server/public/pluginapi/grpc/cmd/apiverify passes AND make -C server/public proto-gen succeeds</verify>
  <done>Phase 2 is complete: no placeholders remain, RPC parity holds, and code generation succeeds.</done>
</task>

</tasks>

<verification>
Before declaring this plan complete:
- [ ] `grep -R "TODO" server/public/pluginapi/grpc/proto/*.proto` returns nothing
- [ ] `go run ./server/public/pluginapi/grpc/cmd/apiverify` reports no missing/extra RPCs
- [ ] `make -C server/public proto-gen` succeeds
</verification>

<success_criteria>

- All Plugin API methods have protobuf request/response definitions
- All placeholder messages removed across all `api_*.proto` files
- RPC parity is enforced by `apiverify`
- Go proto generation succeeds
- Phase 2 is ready for Phase 3 (hooks) and Phase 4 (Go gRPC server implementation)
  </success_criteria>

<output>
After completion, create `.planning/phases/02-api-protobuf-definitions/02-05-SUMMARY.md`:

# Phase 2 Plan 05: Remaining API Protos Summary

**Completed protobuf definitions for the remaining Plugin API surface and validated Phase 2 completeness.**

## Accomplishments

## Files Created/Modified

## Decisions Made

## Issues Encountered

## Next Phase Readiness

- Phase 2 complete, ready for Phase 3 (Hook Protobuf Definitions) and Phase 4 (Go gRPC Server).
</output>


