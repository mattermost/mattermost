---
phase: 13-python-plugin-developer-experience
plan: 02
type: execute
depends_on: []
files_modified: [server/public/Makefile, python-sdk/Makefile]
---

<objective>
Add Makefile targets for complete gRPC code generation (Go + Python) and Python SDK building.

Purpose: Streamline development workflow for regenerating proto code and building the SDK.
Output: Enhanced Makefile with `proto-gen-all`, `python-proto-gen`, and `python-sdk-build` targets.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

**Existing targets:**
@server/public/Makefile

**Python proto generation script:**
@python-sdk/scripts/generate_protos.py

**Python SDK structure:**
@python-sdk/pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Python proto generation target to server Makefile</name>
  <files>server/public/Makefile</files>
  <action>
Add new targets to server/public/Makefile:

1. `python-proto-gen` target:
   - Calls `python-sdk/scripts/generate_protos.py` to generate Python gRPC code
   - Depends on having Python 3.9+ and grpcio-tools installed
   - Generates into `python-sdk/src/mattermost_plugin/grpc/`

2. `proto-gen-all` target:
   - Runs both `proto-gen` (Go) and `python-proto-gen` (Python)
   - Single command for complete regeneration

Add comments explaining:
- When to run these targets (after modifying .proto files)
- Prerequisites (protoc, Python venv with grpcio-tools)

Target structure:
```makefile
## Generates Python gRPC code from .proto files (requires Python 3.9+ and grpcio-tools)
python-proto-gen:
	@echo "Generating Python code from proto files..."
	@cd ../python-sdk && python scripts/generate_protos.py
	@echo "Python proto generation complete."

## Generates both Go and Python code from .proto files
proto-gen-all: proto-gen python-proto-gen
	@echo "All proto generation complete (Go + Python)."
```
  </action>
  <verify>make -n python-proto-gen proto-gen-all from server/ directory shows targets exist</verify>
  <done>Server Makefile has python-proto-gen and proto-gen-all targets</done>
</task>

<task type="auto">
  <name>Task 2: Create Python SDK Makefile</name>
  <files>python-sdk/Makefile</files>
  <action>
Create a new Makefile at python-sdk/Makefile with targets for SDK development:

```makefile
# Python SDK Makefile

.PHONY: venv proto-gen build test lint clean help

PYTHON ?= python3
VENV_DIR := .venv
VENV_PYTHON := $(VENV_DIR)/bin/python

## Creates virtual environment and installs dependencies
venv:
	@echo "Creating virtual environment..."
	$(PYTHON) -m venv $(VENV_DIR)
	$(VENV_PYTHON) -m pip install --upgrade pip
	$(VENV_PYTHON) -m pip install -e ".[dev]"
	@echo "Virtual environment ready. Activate with: source $(VENV_DIR)/bin/activate"

## Generates Python gRPC code from .proto files
proto-gen:
	@echo "Generating Python protobuf/gRPC code..."
	$(VENV_PYTHON) scripts/generate_protos.py
	@echo "Proto generation complete."

## Builds the SDK package (wheel and sdist)
build: proto-gen
	@echo "Building SDK package..."
	$(VENV_PYTHON) -m pip install build
	$(VENV_PYTHON) -m build
	@echo "Build complete. Packages in dist/"

## Runs tests
test:
	@echo "Running tests..."
	$(VENV_PYTHON) -m pytest tests/ -v
	@echo "Tests complete."

## Runs type checking
lint:
	@echo "Running type checking..."
	$(VENV_PYTHON) -m mypy src/mattermost_plugin --ignore-missing-imports
	@echo "Type checking complete."

## Cleans build artifacts
clean:
	rm -rf dist/ build/ *.egg-info src/*.egg-info
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name .mypy_cache -exec rm -rf {} + 2>/dev/null || true
	@echo "Cleaned build artifacts."

## Shows available targets
help:
	@echo "Python SDK Makefile targets:"
	@echo "  venv       - Create virtual environment and install dependencies"
	@echo "  proto-gen  - Generate Python gRPC code from proto files"
	@echo "  build      - Build SDK package (wheel and sdist)"
	@echo "  test       - Run tests"
	@echo "  lint       - Run type checking with mypy"
	@echo "  clean      - Remove build artifacts"
```
  </action>
  <verify>make -n build test from python-sdk/ directory shows targets exist</verify>
  <done>Python SDK Makefile created with venv, proto-gen, build, test, lint, clean targets</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `server/public/Makefile` has `python-proto-gen` and `proto-gen-all` targets
- [ ] `python-sdk/Makefile` exists with all targets
- [ ] `make -n proto-gen-all` from server/ shows both Go and Python generation
- [ ] `make -n build` from python-sdk/ shows build target
</verification>

<success_criteria>

- Server Makefile extended with Python proto generation
- Python SDK has standalone Makefile for common operations
- All targets documented with comments
- Clean target removes all generated artifacts
</success_criteria>

<output>
After completion, create `.planning/phases/13-python-plugin-developer-experience/13-02-SUMMARY.md`
</output>
