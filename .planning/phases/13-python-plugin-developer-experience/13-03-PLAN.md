---
phase: 13-python-plugin-developer-experience
plan: 03
type: execute
depends_on: []
files_modified: [examples/hello_python/Makefile]
---

<objective>
Create a Makefile for the example Python plugin with packaging and development workflow targets.

Purpose: Provide plugin developers with a template Makefile for building and packaging Python plugins.
Output: `examples/hello_python/Makefile` with dist, clean, and development targets.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

**Example plugin structure:**
@examples/hello_python/plugin.py
@examples/hello_python/plugin.json
@examples/hello_python/requirements.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create example plugin Makefile</name>
  <files>examples/hello_python/Makefile</files>
  <action>
Create a Makefile at examples/hello_python/Makefile with targets for plugin development:

```makefile
# Hello Python Plugin Makefile
#
# This Makefile provides targets for developing, testing, and packaging
# Python plugins for Mattermost. Use it as a template for your own plugins.

PLUGIN_ID := com.mattermost.hello-python
PLUGIN_VERSION := 0.1.0
BUNDLE_NAME := hello-python-$(PLUGIN_VERSION).tar.gz

# Python configuration
PYTHON ?= python3
VENV_DIR := venv
VENV_PYTHON := $(VENV_DIR)/bin/python

# SDK location (relative to this plugin)
SDK_DIR := ../../python-sdk

.PHONY: venv install dist clean run test lint help

## Creates virtual environment with SDK and dependencies
venv:
	@echo "Creating virtual environment..."
	$(PYTHON) -m venv $(VENV_DIR)
	$(VENV_PYTHON) -m pip install --upgrade pip
	$(VENV_PYTHON) -m pip install -e $(SDK_DIR)
	$(VENV_PYTHON) -m pip install -r requirements.txt
	@echo "Virtual environment ready. Activate with: source $(VENV_DIR)/bin/activate"

## Installs/updates dependencies in existing venv
install:
	$(VENV_PYTHON) -m pip install -e $(SDK_DIR)
	$(VENV_PYTHON) -m pip install -r requirements.txt

## Packages plugin into tar.gz for upload to Mattermost
dist: clean
	@echo "Packaging plugin as $(BUNDLE_NAME)..."
	@mkdir -p dist/server
	@cp plugin.json dist/
	@cp plugin.py dist/server/
	@cp requirements.txt dist/server/
	@# Include SDK as vendored dependency (optional - comment out if server has SDK installed)
	@if [ -d "$(SDK_DIR)/src/mattermost_plugin" ]; then \
		cp -r $(SDK_DIR)/src/mattermost_plugin dist/server/; \
	fi
	@cd dist && tar -czf ../$(BUNDLE_NAME) .
	@rm -rf dist
	@echo "Created $(BUNDLE_NAME)"
	@echo "Upload this file to your Mattermost server via System Console > Plugins"

## Creates distribution without vendored SDK (server must have SDK installed)
dist-minimal:
	@echo "Packaging minimal plugin (no vendored SDK)..."
	@mkdir -p dist/server
	@cp plugin.json dist/
	@cp plugin.py dist/server/
	@cp requirements.txt dist/server/
	@cd dist && tar -czf ../$(BUNDLE_NAME) .
	@rm -rf dist
	@echo "Created $(BUNDLE_NAME) (minimal - requires SDK on server)"

## Removes build artifacts
clean:
	rm -rf dist/ *.tar.gz
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	@echo "Cleaned build artifacts."

## Runs the plugin locally (for testing gRPC connection)
run:
	@echo "Running plugin locally..."
	@echo "Note: This requires MATTERMOST_PLUGIN_* env vars to be set"
	$(VENV_PYTHON) plugin.py

## Runs linting on plugin code
lint:
	@echo "Running type checking..."
	$(VENV_PYTHON) -m mypy plugin.py --ignore-missing-imports || true
	@echo "Linting complete."

## Shows available targets
help:
	@echo "Hello Python Plugin Makefile"
	@echo ""
	@echo "Targets:"
	@echo "  venv          - Create virtual environment with SDK and dependencies"
	@echo "  install       - Install/update dependencies in existing venv"
	@echo "  dist          - Package plugin as tar.gz (includes vendored SDK)"
	@echo "  dist-minimal  - Package plugin without SDK (server must have SDK)"
	@echo "  clean         - Remove build artifacts"
	@echo "  run           - Run plugin locally (requires env vars)"
	@echo "  lint          - Run type checking on plugin code"
	@echo ""
	@echo "Development workflow:"
	@echo "  1. make venv          # Set up environment"
	@echo "  2. source venv/bin/activate"
	@echo "  3. <edit plugin.py>"
	@echo "  4. make dist          # Package for upload"
	@echo "  5. Upload $(BUNDLE_NAME) to Mattermost"
```
  </action>
  <verify>make -n dist from examples/hello_python/ shows dist target steps</verify>
  <done>Example plugin Makefile created with venv, dist, dist-minimal, clean, run, lint, help targets</done>
</task>

<task type="auto">
  <name>Task 2: Test plugin packaging</name>
  <files>examples/hello_python/Makefile</files>
  <action>
Test the dist target by running it and verifying the tar.gz output:

1. Run `make dist` from examples/hello_python/
2. Verify the tar.gz file is created
3. Check the archive contents include:
   - plugin.json (root level)
   - server/plugin.py
   - server/requirements.txt
   - server/mattermost_plugin/ (vendored SDK)

If SDK is not found, the packaging should still work (minimal mode).

Clean up after test with `make clean`.
  </action>
  <verify>ls -la examples/hello_python/*.tar.gz shows package exists after make dist</verify>
  <done>Plugin packaging works and produces valid tar.gz with expected structure</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `examples/hello_python/Makefile` exists
- [ ] `make dist` produces a tar.gz file
- [ ] `make clean` removes build artifacts
- [ ] `make help` shows available targets
</verification>

<success_criteria>

- Example plugin has Makefile with all development workflow targets
- dist target produces uploadable tar.gz plugin bundle
- Makefile serves as template for other Python plugins
- Help target documents all available commands
</success_criteria>

<output>
After completion, create `.planning/phases/13-python-plugin-developer-experience/13-03-SUMMARY.md`
</output>
