---
phase: 05-enhanced-wizard
plan: 04
type: execute
wave: 2
depends_on: [05-01]
files_modified:
  - webapp/channels/src/components/create_recap_modal/recap_configuration.tsx
  - webapp/channels/src/components/create_recap_modal/create_recap_modal.scss
autonomous: true

must_haves:
  truths:
    - "User sees 'Run once' toggle on Step 1"
    - "Run once toggle is near Next button"
    - "Run once toggle is hidden in edit mode"
  artifacts:
    - path: "webapp/channels/src/components/create_recap_modal/recap_configuration.tsx"
      provides: "Step 1 with run once toggle"
      contains: "runOnce"
    - path: "webapp/channels/src/components/create_recap_modal/create_recap_modal.scss"
      provides: "Styles for run once toggle"
      contains: "run-once"
  key_links:
    - from: "recap_configuration.tsx"
      to: "parent modal state"
      via: "runOnce prop"
      pattern: "setRunOnce"
---

<objective>
Add "Run once" toggle to Step 1 (RecapConfiguration)

Purpose: Users can choose to create an immediate one-time recap that bypasses the schedule configuration step. This toggle appears near the Next button and is hidden in edit mode.

Output: Updated RecapConfiguration with run once toggle
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-enhanced-wizard/05-CONTEXT.md

Reference files:
@webapp/channels/src/components/create_recap_modal/recap_configuration.tsx (current implementation)
@webapp/channels/src/components/toggle.tsx (Toggle component API)
@webapp/channels/src/components/create_recap_modal/create_recap_modal.scss (current styles)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add run once toggle to RecapConfiguration</name>
  <files>webapp/channels/src/components/create_recap_modal/recap_configuration.tsx</files>
  <action>
Modify the RecapConfiguration component to include a "Run once" toggle:

1. Update Props type to include:
```typescript
type Props = {
    recapName: string;
    setRecapName: (name: string) => void;
    recapType: 'selected' | 'all_unreads' | null;
    setRecapType: (type: 'selected' | 'all_unreads') => void;
    unreadChannels: Channel[];
    runOnce: boolean;
    setRunOnce: (value: boolean) => void;
    isEditMode?: boolean;  // When true, hide run once toggle
};
```

2. Update component signature to receive new props:
```typescript
const RecapConfiguration = ({
    recapName, 
    setRecapName, 
    recapType, 
    setRecapType, 
    unreadChannels,
    runOnce,
    setRunOnce,
    isEditMode,
}: Props) => {
```

3. Import Toggle component:
```typescript
import Toggle from 'components/toggle';
```

4. Add run once section at the bottom of the component return, after the type selection group:
```tsx
{/* Run once toggle - hidden in edit mode */}
{!isEditMode && (
    <div className='form-group run-once-group'>
        <div className='run-once-toggle'>
            <Toggle
                id='run-once-toggle'
                toggled={runOnce}
                onToggle={() => setRunOnce(!runOnce)}
                size='btn-sm'
            />
            <label 
                htmlFor='run-once-toggle'
                className='run-once-label'
            >
                <FormattedMessage
                    id='recaps.modal.runOnce'
                    defaultMessage='Run once'
                />
            </label>
        </div>
        <div className='run-once-description'>
            <FormattedMessage
                id='recaps.modal.runOnceDescription'
                defaultMessage='Create an immediate recap without scheduling'
            />
        </div>
    </div>
)}
```

Note: The toggle should appear at the bottom of Step 1, styled as a secondary option.
  </action>
  <verify>grep -q "runOnce" webapp/channels/src/components/create_recap_modal/recap_configuration.tsx && grep -q "Toggle" webapp/channels/src/components/create_recap_modal/recap_configuration.tsx</verify>
  <done>RecapConfiguration has runOnce prop and Toggle component, hidden when isEditMode is true</done>
</task>

<task type="auto">
  <name>Task 2: Add run once toggle styles</name>
  <files>webapp/channels/src/components/create_recap_modal/create_recap_modal.scss</files>
  <action>
Add styles for the run once toggle inside the `.step-one` block:

```scss
        // Run once toggle
        .run-once-group {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid rgba(var(--center-channel-color-rgb), 0.08);

            .run-once-toggle {
                display: flex;
                align-items: center;
                gap: 12px;

                .run-once-label {
                    margin: 0;
                    color: var(--center-channel-color);
                    cursor: pointer;
                    font-size: 14px;
                    font-weight: 600;
                }
            }

            .run-once-description {
                margin-top: 4px;
                margin-left: 52px; // Align with label (toggle width + gap)
                color: rgba(var(--center-channel-color-rgb), 0.64);
                font-size: 12px;
            }
        }
```

Place these styles inside the `.step-one` block, after the `.recap-type-options` styles.
  </action>
  <verify>grep -q "run-once-group" webapp/channels/src/components/create_recap_modal/create_recap_modal.scss</verify>
  <done>Run once toggle styles exist with proper layout and description text</done>
</task>

</tasks>

<verification>
All tasks complete when:
1. recap_configuration.tsx accepts runOnce, setRunOnce, and isEditMode props
2. Toggle component is imported and rendered
3. Toggle is wrapped in conditional that hides it when isEditMode is true
4. SCSS includes .run-once-group and related styles
</verification>

<success_criteria>
- RecapConfiguration accepts all new props
- Toggle renders at bottom of Step 1
- Toggle hidden when isEditMode={true}
- Description text appears below toggle
- Styles match design (separator line, proper spacing)
</success_criteria>

<output>
After completion, create `.planning/phases/05-enhanced-wizard/05-04-SUMMARY.md`
</output>
