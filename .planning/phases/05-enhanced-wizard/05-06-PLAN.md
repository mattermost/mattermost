---
phase: 05-enhanced-wizard
plan: 06
type: execute
wave: 3
depends_on: [05-05]
files_modified:
  - webapp/channels/src/components/recaps/recaps.tsx
autonomous: false

must_haves:
  truths:
    - "User clicks edit on scheduled recap item"
    - "Modal opens with all fields pre-filled from existing scheduled recap"
    - "User can modify fields and save changes"
    - "Updated scheduled recap appears in list with changes"
  artifacts:
    - path: "webapp/channels/src/components/recaps/recaps.tsx"
      provides: "Edit handler passing scheduled recap to modal"
      contains: "editScheduledRecap"
  key_links:
    - from: "recaps.tsx"
      to: "CreateRecapModal"
      via: "dialogProps.editScheduledRecap"
      pattern: "editScheduledRecap:"
---

<objective>
Wire up edit functionality to pass scheduled recap data to modal

Purpose: When user clicks "Edit" on a scheduled recap, the modal should receive the existing scheduled recap data to pre-fill all fields. This completes the edit flow started in Phase 4.

Output: Full edit workflow where clicking edit opens pre-filled modal
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-enhanced-wizard/05-CONTEXT.md

Reference files:
@webapp/channels/src/components/recaps/recaps.tsx (current - handleEditScheduledRecap needs update)
@webapp/channels/src/components/create_recap_modal/create_recap_modal.tsx (updated in 05-05 to accept editScheduledRecap prop)
@webapp/channels/src/packages/mattermost-redux/src/selectors/entities/recaps.ts (getScheduledRecapById if exists, or filter from getAllScheduledRecaps)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update handleEditScheduledRecap to pass scheduled recap to modal</name>
  <files>webapp/channels/src/components/recaps/recaps.tsx</files>
  <action>
Update the handleEditScheduledRecap function to find the scheduled recap by ID and pass it to the modal:

1. Update the handler to find and pass the scheduled recap:
```typescript
const handleEditScheduledRecap = (id: string) => {
    // Find the scheduled recap to edit
    const scheduledRecapToEdit = scheduledRecaps.find((sr) => sr.id === id);
    
    if (!scheduledRecapToEdit) {
        return;
    }
    
    dispatch(openModal({
        modalId: ModalIdentifiers.CREATE_RECAP_MODAL,
        dialogType: CreateRecapModal,
        dialogProps: {
            editScheduledRecap: scheduledRecapToEdit,
        },
    }));
};
```

This uses the existing scheduledRecaps array from useSelector(getAllScheduledRecaps) to find the recap by ID, then passes it as the editScheduledRecap prop.

Note: If getAllScheduledRecaps returns an object (Record<string, ScheduledRecap>) instead of an array, adjust:
```typescript
const scheduledRecapToEdit = scheduledRecaps[id];
```

Check the actual return type from the selector to use the correct lookup method.
  </action>
  <verify>grep -q "editScheduledRecap:" webapp/channels/src/components/recaps/recaps.tsx</verify>
  <done>handleEditScheduledRecap finds scheduled recap by ID and passes it to modal as editScheduledRecap prop</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete wizard flow with edit mode and run once functionality</what-built>
  <how-to-verify>
    1. Navigate to Recaps page
    2. Click "Add a recap" button
    3. Test run once flow:
       - Enter a name, select "Recap selected channels"
       - Check "Run once" toggle
       - Click Next, select channels
       - Click "Start recap" - should create immediate recap
    4. Test scheduled flow:
       - Enter a name, select "Recap selected channels"
       - Leave "Run once" unchecked
       - Click Next, select channels
       - Click Next to see schedule configuration
       - Select days (e.g., Mon, Wed, Fri)
       - Select time (e.g., 9:00 AM)
       - Verify next run preview appears with timezone
       - Add custom instructions (optional)
       - Click "Create schedule"
       - Scheduled recap should appear in Scheduled tab
    5. Test edit mode:
       - Go to Scheduled tab
       - Click kebab menu on a scheduled recap
       - Click "Edit"
       - Modal should open with all fields pre-filled:
         - Name matches
         - Type matches
         - Days selected match
         - Time matches
         - Custom instructions match
       - Change time to different value
       - Click "Save changes"
       - Verify updated time shows in list
  </how-to-verify>
  <resume-signal>Type "verified" to confirm wizard works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
All tasks complete when:
1. handleEditScheduledRecap passes editScheduledRecap to modal via dialogProps
2. Modal opens with pre-filled fields in edit mode
3. Changes can be saved and appear in the list
</verification>

<success_criteria>
- Run once flow creates immediate recap (existing behavior preserved)
- Scheduled flow creates scheduled recap visible in Scheduled tab
- Edit opens modal with pre-filled values
- Save changes updates the scheduled recap
- All UI text uses i18n message IDs
</success_criteria>

<output>
After completion, create `.planning/phases/05-enhanced-wizard/05-06-SUMMARY.md`
</output>
