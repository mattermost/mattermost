# Milestone v1.0: Python Plugin Support

**Status:** ✅ SHIPPED 2026-01-20
**Phases:** 1-13
**Total Plans:** 41

## Overview

Build a gRPC-based protocol layer enabling Python plugins to communicate with the Mattermost server, achieving full parity with Go plugins. Starting with protocol definitions and Go-side infrastructure, then building the Python SDK and hook system, culminating in manifest support and end-to-end integration testing.

## Phases

### Phase 1: Protocol Foundation
**Goal**: Establish gRPC infrastructure and define core protobuf types shared across all API methods and hooks
**Depends on**: Nothing (first phase)
**Plans**: 3 plans

Plans:
- [x] 01-01: gRPC dependency setup and build configuration ✓
- [x] 01-02: Core protobuf types (User, Channel, Post, Team, etc.) ✓
- [x] 01-03: Error handling and common patterns ✓

**Details:**
Created directory structure, proto-tools and proto-gen Make targets, bootstrap.proto with core types.

### Phase 2: API Protobuf Definitions
**Goal**: Complete protobuf definitions for all 100+ Plugin API methods
**Depends on**: Phase 1
**Plans**: 5 plans

Plans:
- [x] 02-01: User and Team API methods ✓
- [x] 02-02: Channel and Post API methods ✓
- [x] 02-03: KV Store and Configuration API methods ✓
- [x] 02-04: File and Bot API methods ✓
- [x] 02-05: Remaining API methods (OAuth, Preferences, etc.) ✓

**Details:**
All 236 RPC methods defined across api.proto and domain-specific message files.

### Phase 3: Hook Protobuf Definitions
**Goal**: Complete protobuf definitions for all plugin hooks
**Depends on**: Phase 1
**Plans**: 4 plans

Plans:
- [x] 03-01: Lifecycle hooks (OnActivate, OnDeactivate, etc.) ✓
- [x] 03-02: Message hooks (MessagePosted, MessageUpdated, etc.) ✓
- [x] 03-03: User and Channel hooks ✓
- [x] 03-04: Command and Webhook hooks ✓

**Details:**
All 35+ hooks defined in hooks.proto and domain-specific message files.

### Phase 4: Go gRPC Server
**Goal**: Implement Go gRPC server that wraps the existing Plugin API, callable by Python plugins
**Depends on**: Phase 2, Phase 3
**Plans**: 4 plans

Plans:
- [x] 04-01: gRPC server scaffolding and plugin API wrapper ✓
- [x] 04-02: Implement User/Team/Channel API handlers ✓
- [x] 04-03: Implement Post/File/KV Store API handlers ✓
- [x] 04-04: Implement remaining API handlers ✓

**Details:**
Domain-split handler files (handlers_user.go, handlers_team.go, etc.) with conversion helpers.

### Phase 5: Python Supervisor
**Goal**: Go-side supervisor that spawns Python plugin subprocesses and manages gRPC connections
**Depends on**: Phase 4
**Plans**: 3 plans

Plans:
- [x] 05-01: Python process spawning and lifecycle management ✓
- [x] 05-02: gRPC connection establishment and handshake ✓
- [x] 05-03: Health checking and restart logic ✓

**Details:**
python_supervisor.go with fake Python interpreter pattern for hermetic tests.

### Phase 6: Python SDK Core
**Goal**: Python package with typed gRPC client providing access to all Plugin API methods
**Depends on**: Phase 4
**Plans**: 4 plans

Plans:
- [x] 06-01: Python package structure and gRPC client setup ✓
- [x] 06-02: Typed API client for User/Team/Channel methods ✓
- [x] 06-03: Typed API client for Post/File/KV Store methods ✓
- [x] 06-04: Typed API client for remaining methods ✓

**Details:**
Domain-specific mixin classes (UsersMixin, TeamsMixin, etc.) with frozen dataclass wrappers. 100% RPC coverage (236/236).

### Phase 7: Python Hook System
**Goal**: Pythonic pattern for plugins to implement hooks (decorators or class methods)
**Depends on**: Phase 6
**Plans**: 3 plans

Plans:
- [x] 07-01: Hook registration mechanism design ✓
- [x] 07-02: Implement lifecycle and message hooks ✓
- [x] 07-03: Implement remaining hooks ✓

**Details:**
@hook decorator + HookName enum pattern. Plugin base class with __init_subclass__ for automatic hook discovery. gRPC health service for go-plugin.

### Phase 8: ServeHTTP Streaming
**Goal**: Support ServeHTTP hook with proper HTTP request/response streaming over gRPC
**Depends on**: Phase 7
**Plans**: 2 plans

Plans:
- [x] 08-01: HTTP request streaming from Go to Python ✓
- [x] 08-02: HTTP response streaming from Python to Go ✓

**Details:**
Bidirectional streaming with 64KB chunks. HTTPRequest/HTTPResponseWriter pattern matching Go http.Handler semantics.

### Phase 9: Manifest Extension
**Goal**: Extend plugin manifest format to support Python executables and entry points
**Depends on**: Phase 5
**Plans**: 2 plans

Plans:
- [x] 09-01: Manifest schema extension for Python plugins ✓
- [x] 09-02: Manifest parsing and validation updates ✓

**Details:**
Runtime field with empty default for backward compatibility. ManifestPython as pointer for nil check.

### Phase 10: Integration & Testing
**Goal**: End-to-end testing with example Python plugin, performance benchmarks, documentation
**Depends on**: Phase 8, Phase 9
**Plans**: 3 plans

Plans:
- [x] 10-01: Example Python plugin implementation ✓
- [x] 10-02: Integration test suite ✓
- [x] 10-03: Performance benchmarks and documentation ✓

**Details:**
hello_python example plugin. CI-friendly integration test runner scripts. Go gRPC benchmark tests.

### Phase 11: Server Integration
**Goal**: Wire Python plugin support into main Mattermost server so plugins can be uploaded and run
**Depends on**: Phase 10
**Plans**: 3 plans

Plans:
- [x] 11-01: hooksGRPCClient adapter implementing Hooks interface ✓
- [x] 11-02: Wire hooksGRPCClient into supervisor ✓
- [x] 11-03: Integration tests and documentation ✓

**Details:**
hooksGRPCClient mirrors hooksRPCClient pattern. Extract gRPC conn from GRPCClient.Conn for go-plugin.

### Phase 12: Python API Callback Server
**Goal**: Start a gRPC PluginAPI server on the Go side that Python plugins can call back to for API operations
**Depends on**: Phase 11
**Plans**: 1 plan

Plans:
- [x] 12-01: Start gRPC PluginAPI server and pass address to Python via env var ✓

**Details:**
MATTERMOST_PLUGIN_API_TARGET env var. APIServerRegistrar function type for breaking import cycles.

### Phase 13: Python Plugin Developer Experience
**Goal**: Complete documentation, tooling, and developer guidance for Python plugin development
**Depends on**: Phase 12
**Plans**: 4 plans

Plans:
- [x] 13-01: Architecture documentation for internal developers ✓
- [x] 13-02: Server Makefile gRPC tooling ✓
- [x] 13-03: Example plugin Makefile and packaging ✓
- [x] 13-04: Claude.md files for agentic development ✓

**Details:**
ARCHITECTURE.md with diagrams. proto-gen-all Make target. Example plugin Makefile with dist/venv targets. CLAUDE.md files for example plugin, Python SDK, and server gRPC.

---

## Milestone Summary

**Key Decisions:**
- gRPC over JSON-RPC: Strong typing via protobuf, streaming for ServeHTTP
- Per-group proto files: Maintainability (api_user_team, api_channel_post, etc.)
- JSON blob for complex types: Config, License, Manifest use bytes to avoid proto churn
- @hook decorator pattern: Pythonic registration with __init_subclass__
- 64KB chunks for HTTP streaming: Balances latency vs overhead
- hooksGRPCClient adapter: Implements Hooks interface, mirrors hooksRPCClient

**Issues Resolved:**
- Python plugins can now call back to Go API (Phase 12)
- Full hook parity achieved including ServeHTTP streaming
- Manifest backward compatibility maintained

**Issues Deferred:**
- Streaming for UploadData/InstallPlugin (currently unary with bytes)
- Performance parity with Go plugins (inherent Python overhead)

**Technical Debt Incurred:**
- None significant

---

_For current project status, see .planning/ROADMAP.md_
